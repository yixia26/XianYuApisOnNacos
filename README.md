# ğŸŸ XianYuApis - é—²é±¼ç¬¬ä¸‰æ–¹APIé›†æˆåº“

[![Python Version](https://img.shields.io/badge/python-3.7%2B-blue)](https://www.python.org/)
[![Python Version](https://img.shields.io/badge/nodejs-18%2B-blue)](https://nodejs.org/zh-cn/)

**âœ¨ éå®˜æ–¹é—²é±¼å¼€æ”¾APIæ¥å£å°è£…åº“ï¼Œé€šè¿‡ç½‘ç»œè¯·æ±‚æ“ä½œæ‰€æœ‰çš„é—²é±¼æ“ä½œï¼Œæä¾›å®‰å…¨å¯é çš„é—²é±¼å¹³å°åŠŸèƒ½è®¿é—®èƒ½åŠ›ã€‚**
**âš ï¸ æ³¨æ„ï¼šå¦‚æœ‰ä¾µæƒè”ç³»ä½œè€…åˆ é™¤ã€‚**


| æ¨¡å—       | å·²å®ç°                                                                             |
|----------|---------------------------------------------------------------------------------|
| é—²é±¼PC | âœ… é—²é±¼æ‰€æœ‰httpæ¥å£ï¼ˆsignå‚æ•°è§£å¯†ï¼‰    |
| é—²é±¼PC | âœ… é—²é±¼websocketsç§ä¿¡wsåè®®ï¼ˆæ¥æ”¶å‘æ¶ˆæ¯ï¼Œsign+base64+protobufåè®®ï¼‰      |


## ğŸš€ ä¸€äº›æˆå“
- https://github.com/shaxiu/XianyuAutoAgent




## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- RESTful API + WebSocket åŒé€šé“
- ç‹¬ç«‹åŠŸèƒ½ç»„ä»¶å³æ’å³ç”¨
- åŸºäº`asyncio`çš„å…¨å¼‚æ­¥æ¶æ„ğŸš€

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹
### â›³è¿è¡Œç¯å¢ƒ
- Python 3.7+
- Node.js 18+

### ğŸ¯å®‰è£…ä¾èµ–
```
pip install -r requirements.txt
npm install
```

### ğŸ¨é…ç½®æ–‡ä»¶
å¤åˆ¶cookieåˆ°ä»£ç ä¸­ï¼ˆæ³¨æ„ï¼ç™»å½•é—²é±¼åçš„cookieæ‰æ˜¯æœ‰æ•ˆçš„ï¼Œä¸ç™»é™†æ²¡æœ‰ç”¨ï¼Œä¸ç„¶æ€ä¹ˆçŸ¥é“ç»™è°å‘æ¶ˆæ¯ï¼‰
æœ¬é¡¹ç›®ä¸ºé€†å‘é—²é±¼æä¾›å¯é çš„apiè®¿é—®é—²é±¼èƒ½åŠ›ï¼Œenvæ–‡ä»¶ä½œè€…å¿˜äº†æ”¾äº†ï¼Œä¸‹ä¸ªç‰ˆæœ¬æ”¾è¿›å»


### ğŸš€è¿è¡Œé¡¹ç›®
```
python XianyuAutoAsync.py
```

### ğŸ—ï¸æ³¨æ„äº‹é¡¹
- XianyuAutoAsync.pyä¸­çš„ä»£ç æ˜¯æ¥æ”¶å‘æ¶ˆæ¯çš„ä¸»å…¥å£ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹
- XianyuApis.pyä¸­çš„ä»£ç åŒ…å«äº†apiæ¥å£çš„æ¨¡æ¿ï¼Œsignå‚æ•°å·²ç»è§£å¯†ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼Œæ·»åŠ å…¶ä»–çš„æ¥å£


## ğŸ§¸é¢å¤–è¯´æ˜
1. æ„Ÿè°¢starâ­å’ŒfollowğŸ“°ï¼ä¸æ—¶æ›´æ–°
2. ä½œè€…çš„è”ç³»æ–¹å¼åœ¨ä¸»é¡µé‡Œï¼Œæœ‰é—®é¢˜å¯ä»¥éšæ—¶è”ç³»æˆ‘
3. å¯ä»¥å…³æ³¨ä¸‹ä½œè€…çš„å…¶ä»–é¡¹ç›®ï¼Œæ¬¢è¿ PR å’Œ issue
4. æ„Ÿè°¢èµåŠ©ï¼å¦‚æœæ­¤é¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ä½œè€…å–ä¸€æ¯å¥¶èŒ¶~~ ï¼ˆå¼€å¿ƒä¸€æ•´å¤©ğŸ˜ŠğŸ˜Šï¼‰
5. thank you~~~

<div align="center">
  <img src="./author/wx_pay.png" width="400px" alt="å¾®ä¿¡èµèµç ">â€ƒ
  <img src="./author/zfb_pay.jpg" width="400px" alt="æ”¯ä»˜å®æ”¶æ¬¾ç ">
</div>


## ğŸ“ˆ Star è¶‹åŠ¿
<a href="https://www.star-history.com/#cv-cat/XianYuApis&Date">
 <picture>
   <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=cv-cat/XianYuApis&type=Date&theme=dark" />
   <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=cv-cat/XianYuApis&type=Date" />
   <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=cv-cat/XianYuApis&type=Date" />
 </picture>
</a>

# é—²é±¼ API æœåŠ¡

è¿™æ˜¯ä¸€ä¸ªåŸºäº FastAPI çš„é—²é±¼ API æœåŠ¡ï¼Œæä¾›é—²é±¼èŠå¤©ã€æ¶ˆæ¯å‘é€ç­‰åŠŸèƒ½ï¼Œå¹¶æ³¨å†Œåˆ° Nacos æœåŠ¡å‘ç°ä¸­å¿ƒã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- åˆ›å»ºé—²é±¼ä¼šè¯
- å‘é€é—²é±¼æ¶ˆæ¯
- åˆ›å»ºèŠå¤©å¯¹è¯
- è‡ªåŠ¨å›å¤åŠŸèƒ½
- æ³¨å†Œåˆ° Nacos æœåŠ¡å‘ç°ä¸­å¿ƒ

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## ç¯å¢ƒå˜é‡é…ç½®

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æœåŠ¡å‚æ•°ï¼š

- `NACOS_SERVER_ADDR`: Nacos æœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ä¸º `localhost:8848`
- `NACOS_NAMESPACE`: Nacos å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º `public`
- `NACOS_USERNAME`: Nacos ç”¨æˆ·åï¼Œé»˜è®¤ä¸º `nacos`
- `NACOS_PASSWORD`: Nacos å¯†ç ï¼Œé»˜è®¤ä¸º `nacos`
- `SERVICE_NAME`: æœåŠ¡åç§°ï¼Œé»˜è®¤ä¸º `xy-xianyuApi`
- `SERVICE_IP`: æœåŠ¡ IPï¼Œé»˜è®¤ä¸º `localhost`
- `SERVICE_PORT`: æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ä¸º `8000`

## è¿è¡ŒæœåŠ¡

```bash
uvicorn api:app --host 0.0.0.0 --port 8000 --reload
```

## Docker éƒ¨ç½²

### æ„å»ºé•œåƒ

```bash
docker build -t xianyuapi .
```

### è¿è¡Œå®¹å™¨

```bash
docker run -p 8000:8000 \
  -e NACOS_SERVER_ADDR=nacos-server:8848 \
  -e SERVICE_IP=container-ip \
  xianyuapi
```

## API æ¥å£

### åˆ›å»ºä¼šè¯

```
POST /api/v1/session/create
```

è¯·æ±‚ä½“:

```json
{
  "cookies_str": "ä½ çš„é—²é±¼cookieså­—ç¬¦ä¸²",
  "auto_reply": false
}
```

### å‘é€æ¶ˆæ¯

```
POST /api/v1/message/send
```

è¯·æ±‚ä½“:

```json
{
  "session_id": "session_1",
  "to_id": "æ¥æ”¶è€…ID",
  "item_id": "å•†å“ID",
  "text": "è¦å‘é€çš„æ¶ˆæ¯"
}
```

### åˆ›å»ºèŠå¤©

```
POST /api/v1/chat/create
```

è¯·æ±‚ä½“:

```json
{
  "session_id": "session_1",
  "to_id": "æ¥æ”¶è€…ID",
  "item_id": "å•†å“ID"
}
```

### åˆ—å‡ºä¼šè¯

```
GET /api/v1/session/list
```

### åˆ é™¤ä¼šè¯

```
DELETE /api/v1/session/{session_id}
```

### å¥åº·æ£€æŸ¥

```
GET /health
```

## ç¤ºä¾‹ä»£ç 

```python
import requests

# åˆ›å»ºä¼šè¯
cookies_str = "your_cookies_string"
response = requests.post(
    "http://localhost:8000/api/v1/session/create",
    json={"cookies_str": cookies_str, "auto_reply": False}
)
session_id = response.json()["session_id"]

# å‘é€æ¶ˆæ¯
requests.post(
    "http://localhost:8000/api/v1/message/send",
    json={
        "session_id": session_id,
        "to_id": "receiver_id",
        "item_id": "item_id",
        "text": "Hello, World!"
    }
)
```
